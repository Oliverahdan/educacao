<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Escolas</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body class="fundo">
    <div class="pesquisa">
        <header class="titulo">Sistema de Educação Básica de Divinópolis</header>
        <div class="escola">
            <select id="escolaSelect" class="menususpenso" onchange="buscarEscola()">
                <option value="" disabled selected>Selecione a escola:</option>
                <!-- As opções da lista suspensa serão preenchidas dinamicamente com JavaScript -->
            </select>
        </div>

        <div class="ano">
            <select id="anoSelect" class="menususpenso" onchange="buscarAno()">
                <option value="" disabled selected>Selecione o ano:</option>
                <!-- As opções da lista suspensa serão preenchidas dinamicamente com JavaScript -->
            </select>
        </div>

        <div class="lupa">
            <img src="/img/lupa.png" alt="lupa" onclick="buscarInformacoes()" style="width: 50px; height: 50px; cursor: pointer;">
        </div>

        <div class="filtro">
            <img src="/img/filtro.png" alt="filtro" onclick="exibirMenuFiltro()" style="width: 40px; height: 40px; cursor: pointer;">
            <select id="filtro" style="display: none;" onchange="aplicarFiltro()">
                <option value="" disabled selected>Selecione um filtro:</option>
                <option value="taxa_aprovacao">Taxa de Aprovação</option>
                <option value="indicador_rendimento">Indicador de Rendimento</option>
                <option value="nota_saeb_matematica">Nota Saeb Matemática</option>
                <option value="nota_saeb_lingua_portuguesa">Nota Saeb Língua Portuguesa</option>
                <option value="nota_saeb_media_padronizada">Nota Saeb Média Padronizada</option>
                <option value="ideb">Índice de Desenvolvimento da Educação Básica</option>
                <option value="projecao">Projeção</option>
            </select>
        </div>

        <div id="informacoesEscola">
            <!-- As informações da escola selecionada serão exibidas aqui -->
        </div>
    </div>

    <script> 
        let dataset;
        let escolasMap = {};
        let anoSelecionado;
        let escolaSelecionada;

        // Carrega o dataset.json e o escolas.json
        Promise.all([
            fetch('dataset.json').then(response => response.json()),
            fetch('escolas.json').then(response => response.json())
        ])
        .then(([data, escolasData]) => {
            dataset = data; // Atribui o dataset à variável global

            // Mapeia os IDs de escola para seus respectivos nomes
            escolasData.forEach(escola => {
                escolasMap[escola.id] = escola.nome;
            });

            // Obtém todas as entradas únicas de anos do dataset
            const anosUnicos = Array.from(new Set(data.map(entry => entry.ano))).sort().reverse();

            // Preenche a lista suspensa com os anos
            const anoSelect = document.getElementById('anoSelect');
            anosUnicos.forEach(ano => {
                const option = document.createElement('option');
                option.value = ano;
                option.text = ano;
                anoSelect.appendChild(option);
            });

            // Obtém todas as entradas do dataset
            const nomesUnicos = new Set();
            const escolasComNomes = data
                .filter(entry => entry.id_escola && escolasMap[entry.id_escola])
                .sort((a, b) => escolasMap[b.id_escola].localeCompare(escolasMap[a.id_escola]));

            // Preenche a lista suspensa com os nomes de escola
            const escolaSelect = document.getElementById('escolaSelect');
            escolasComNomes.forEach(escola => {
                const nomeEscola = escolasMap[escola.id_escola];
                if (!nomesUnicos.has(nomeEscola)) {
                    nomesUnicos.add(nomeEscola);

                    const option = document.createElement('option');
                    option.value = escola.id_escola;
                    option.text = nomeEscola;
                    escolaSelect.appendChild(option);
                }
            });
        })
        .catch(error => console.error('Erro ao carregar os dados:', error));

        function mapearNivelDeEnsino(anosEscolares) {
            if (anosEscolares === 'iniciais (1-5)') {
                return 'Ensino Fundamental 1';
            } else if (anosEscolares === 'finais (6-9)') {
                return 'Ensino Fundamental 2';
            } else if (anosEscolares === 'todos (1-4)') {
                return 'Ensino Médio';
            } else {
                return 'Nível de Ensino Desconhecido';
            }
        }

        // Função chamada quando uma escola é selecionada na lista suspensa
        function buscarEscola() {
            escolaSelecionada = document.getElementById('escolaSelect').value;
        }

        // Função chamada quando um ano é selecionado na lista suspensa
        function buscarAno() {
            anoSelecionado = document.getElementById('anoSelect').value;
        }

        // Função chamada quando a imagem da lupa é clicada
        function buscarInformacoes() {
            const informacoesEscola = document.getElementById('informacoesEscola');
            // Procura a escola no dataset com base no id selecionado
            const escolaSelecionadaInfo = dataset.find(entry => entry.id_escola === escolaSelecionada && entry.ano === anoSelecionado);

            // Obtém o nome da escola com base no ID
            const nomeEscola = escolasMap[escolaSelecionada] || 'Nome não encontrado';

            // Mapeia os anos escolares para os níveis de ensino correspondentes
            const nivelDeEnsino = mapearNivelDeEnsino(escolaSelecionadaInfo.anos_escolares);

            // Exibe as informações da escola
            if (escolaSelecionadaInfo) {
                informacoesEscola.innerHTML = `
                    <h2>${nomeEscola}</h2>
                    <p>Rede: ${escolaSelecionadaInfo.rede}</p>
                    <p>${nivelDeEnsino}</p>
                    <p>Taxa de Aprovação: ${escolaSelecionadaInfo.taxa_aprovacao}</p>
                    <p>Indicador de Rendimento: ${escolaSelecionadaInfo.indicador_rendimento}</p>
                    <p>Nota Saeb Matemática: ${escolaSelecionadaInfo.nota_saeb_matematica}</p>
                    <p>Nota Saeb Língua Portuguesa: ${escolaSelecionadaInfo.nota_saeb_lingua_portuguesa}</p>
                    <p>Nota Saeb Média Padronizada: ${escolaSelecionadaInfo.nota_saeb_media_padronizada}</p>
                    <p>Ideb: ${escolaSelecionadaInfo.ideb}</p>
                    <p>Projeção: ${escolaSelecionadaInfo.projecao}</p>
                `;
            } else {
                informacoesEscola.innerHTML = '<p>Escola não encontrada para o ano selecionado.</p>';
            }
        }

        // Função chamada quando a imagem do filtro é clicada para exibir o menu de filtro
        function exibirMenuFiltro() {
            const filtroSelect = document.getElementById('filtro');
            filtroSelect.style.display = 'block';
        }

        // Função chamada quando uma opção de filtro é selecionada
        function aplicarFiltro() {
            const filtroSelect = document.getElementById('filtro');
            const filtroSelecionado = filtroSelect.value;

            // Realize as operações necessárias com base no filtro selecionado
            // ...

            // Oculte o menu de filtro após a seleção
            filtroSelect.style.display = 'none';
        }
    </script>
</body>
</html>
