<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Escolas</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body class="fundo">
    <div class="pesquisa">
        <header class="titulo">Sistema de Educação Básica de Divinópolis</header>
        <div class="escola">
            <select id="escolaSelect" onchange="buscarEscola()" class="menususpenso">
                <option value="" disabled selected>Selecione a escola:</option>
                <!-- As opções da lista suspensa serão preenchidas dinamicamente com JavaScript -->
            </select>
        </div>

        <div class="ano">
            <select id="anoSelect" onchange="buscarAno()" class="menususpenso">
                <option value="" disabled selected>Selecione o ano:</option>
                <!-- As opções da lista suspensa serão preenchidas dinamicamente com JavaScript -->
            </select>
        </div>

        <div class="lupa" onclick="buscarInformacoes()">
            <img src="/img/lupa.png" alt="lupa" style="width: 50px; height: 50px; cursor: pointer;">
        </div>

        <div id="informacoesEscola">
            <!-- As informações da escola selecionada serão exibidas aqui -->
        </div>
    </div>

    <script> 
        let dataset;
        let escolasMap = {};

        // Carrega o dataset.json e o escolas.json
        Promise.all([
            fetch('dataset.json').then(response => response.json()),
            fetch('escolas.json').then(response => response.json())
        ])
        .then(([data, escolasData]) => {
            dataset = data; // Atribui o dataset à variável global

            // Mapeia os IDs de escola para seus respectivos nomes
            escolasData.forEach(escola => {
                escolasMap[escola.id] = escola.nome;
            });

            // Obtém todas as entradas únicas de anos do dataset
            const anosUnicos = Array.from(new Set(data.map(entry => entry.ano))).sort().reverse();

            // Preenche a lista suspensa com os anos
            const anoSelect = document.getElementById('anoSelect');
            anosUnicos.forEach(ano => {
                const option = document.createElement('option');
                option.value = ano;
                option.text = ano;
                anoSelect.appendChild(option);
            });

            // Obtém todas as entradas do dataset
            const nomesUnicos = new Set();
            const escolasComNomes = data
                .filter(entry => entry.id_escola && escolasMap[entry.id_escola])
                .sort((a, b) => escolasMap[b.id_escola].localeCompare(escolasMap[a.id_escola]));

            // Preenche a lista suspensa com os nomes de escola
            const escolaSelect = document.getElementById('escolaSelect');
            escolasComNomes.forEach(escola => {
                const nomeEscola = escolasMap[escola.id_escola];
                if (!nomesUnicos.has(nomeEscola)) {
                    nomesUnicos.add(nomeEscola);

                    const option = document.createElement('option');
                    option.value = escola.id_escola;
                    option.text = nomeEscola;
                    escolaSelect.appendChild(option);
                }
            });
        })
        .catch(error => console.error('Erro ao carregar os dados:', error));

        function mapearNivelDeEnsino(anosEscolares) {
            if (anosEscolares === 'iniciais (1-5)') {
                return 'Ensino Fundamental 1';
            } else if (anosEscolares === 'finais (6-9)') {
                return 'Ensino Fundamental 2';
            } else if (anosEscolares === 'todos (1-4)') {
                return 'Ensino Médio';
            } else {
                return 'Nível de Ensino Desconhecido';
            }
        }

        // Função chamada quando uma escola é selecionada na lista suspensa
        function buscarEscola() {
            const escolaId = document.getElementById('escolaSelect').value;
            const informacoesEscola = document.getElementById('informacoesEscola');

            // Procura a escola no dataset com base no id selecionado
            const escolaSelecionada = dataset.find(entry => entry.id_escola === escolaId);

            // Obtém o nome da escola com base no ID
            const nomeEscola = escolasMap[escolaId] || 'Nome não encontrado';

            // Mapeia os anos escolares para os níveis de ensino correspondentes
            const nivelDeEnsino = mapearNivelDeEnsino(escolaSelecionada.anos_escolares);

            // Exibe as informações da escola
            if (escolaSelecionada) {
                informacoesEscola.innerHTML = `
                    <h2>${nomeEscola}</h2>
                    <p>Rede: ${escolaSelecionada.rede}</p>
                    <p>${nivelDeEnsino}</p>
                    <p>Taxa de Aprovação: ${escolaSelecionada.taxa_aprovacao}</p>
                    <p>Indicador de Rendimento: ${escolaSelecionada.indicador_rendimento}</p>
                    <p>Nota Saeb Matemática: ${escolaSelecionada.nota_saeb_matematica}</p>
                    <p>Nota Saeb Língua Portuguesa: ${escolaSelecionada.nota_saeb_lingua_portuguesa}</p>
                    <p>Nota Saeb Média Padronizada: ${escolaSelecionada.nota_saeb_media_padronizada}</p>
                    <p>Ideb: ${escolaSelecionada.ideb}</p>
                    <p>Projeção: ${escolaSelecionada.projecao}</p>
                `;
            } else {
                informacoesEscola.innerHTML = '<p>Escola não encontrada.</p>';
            }
        }

        // Função chamada quando um ano é selecionado na lista suspensa
        function buscarAno() {
            const anoSelecionado = document.getElementById('anoSelect').value;
            const informacoesEscola = document.getElementById('informacoesEscola');

            // Filtra as escolas com base no ano selecionado
            const escolasDoAno = dataset
                .filter(entry => entry.ano === anoSelecionado)
                .sort((a, b) => escolasMap[b.id_escola].localeCompare(escolasMap[a.id_escola]));

            // Gera as informações das escolas do ano
            let infoEscolas = '';
            if (escolasDoAno.length > 0) {
                infoEscolas += `<h2>Escolas do Ano ${anoSelecionado}</h2>`;
                escolasDoAno.forEach(escola => {
                    const nomeEscola = escolasMap[escola.id_escola] || 'Nome não encontrado';
                    const nivelDeEnsino = mapearNivelDeEnsino(escola.anos_escolares);
                    infoEscolas += `
                        <p>${nomeEscola} - ${nivelDeEnsino}</p>
                    `;
                });
            } else {
                infoEscolas = '<p>Nenhuma escola encontrada para o ano selecionado.</p>';
            }

            // Exibe as informações das escolas do ano
            informacoesEscola.innerHTML = infoEscolas;
        }

        // Função chamada quando a imagem da lupa é clicada
        function buscarInformacoes() {
            // Obtém o valor selecionado na lista suspensa de escolas
            const escolaSelecionadaId = document.getElementById('escolaSelect').value;

            // Procura a escola no dataset com base no id selecionado
            const escolaSelecionada = dataset.find(entry => entry.id_escola === escolaSelecionadaId);

            // Se a escola foi encontrada, exibe as informações
            if (escolaSelecionada) {
                // Obtém o nome da escola com base no ID
                const nomeEscola = escolasMap[escolaSelecionadaId] || 'Nome não encontrado';

                // Mapeia os anos escolares para os níveis de ensino correspondentes
                const nivelDeEnsino = mapearNivelDeEnsino(escolaSelecionada.anos_escolares);

                // Exibe as informações da escola
                const informacoesEscola = document.getElementById('informacoesEscola');
                informacoesEscola.innerHTML = `
                    <h2>${nomeEscola}</h2>
                    <p>Rede: ${escolaSelecionada.rede}</p>
                    <p>${nivelDeEnsino}</p>
                    <p>Taxa de Aprovação: ${escolaSelecionada.taxa_aprovacao}</p>
                    <p>Indicador de Rendimento: ${escolaSelecionada.indicador_rendimento}</p>
                    <p>Nota Saeb Matemática: ${escolaSelecionada.nota_saeb_matematica}</p>
                    <p>Nota Saeb Língua Portuguesa: ${escolaSelecionada.nota_saeb_lingua_portuguesa}</p>
                    <p>Nota Saeb Média Padronizada: ${escolaSelecionada.nota_saeb_media_padronizada}</p>
                    <p>Ideb: ${escolaSelecionada.ideb}</p>
                    <p>Projeção: ${escolaSelecionada.projecao}</p>
                `;
            }
        }
    </script>
</body>
</html>
